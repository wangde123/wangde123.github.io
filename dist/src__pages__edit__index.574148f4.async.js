"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[450],{72875:function(X,U,s){s.r(U),s.d(U,{default:function(){return T}});var E=s(90228),d=s.n(E),B=s(48305),D=s.n(B),J=s(87999),C=s.n(J),j=s(75271),f=s(25880),P=s(11711),A=s(5321),k={body:"body___GoEWp"},F=s(52676),b=(0,A.eI)("https://tuiwsyyxhzhjonchrtps.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR1aXdzeXl4aHpoam9uY2hydHBzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3NDc3NjQsImV4cCI6MjA4MDMyMzc2NH0.6izd1nRzDu3FUc7Yx08W_-MN05l21uVy1sbe13Np3kA"),y="photos";function R(I){return $.apply(this,arguments)}function $(){return $=C()(d()().mark(function I(c){var M,h,g,w,N,l,i,t,a,u,o,n=arguments;return d()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(M=n.length>1&&n[1]!==void 0?n[1]:1280,h=n.length>2&&n[2]!==void 0?n[2]:.8,c.type.startsWith("image/")){e.next=4;break}return e.abrupt("return",c);case 4:return e.next=6,createImageBitmap(c);case 6:if(g=e.sent,w=g.width,N=g.height,l=Math.min(1,M/Math.max(w,N)),i=Math.max(1,Math.round(w*l)),t=Math.max(1,Math.round(N*l)),a=document.createElement("canvas"),a.width=i,a.height=t,u=a.getContext("2d"),u){e.next=17;break}return e.abrupt("return",c);case 17:return u.drawImage(g,0,0,i,t),o=c.type.includes("png")?"image/png":"image/jpeg",e.abrupt("return",new Promise(function(r){a.toBlob(function(v){return r(v||c)},o,h)}));case 20:case"end":return e.stop()}},I)})),$.apply(this,arguments)}var S=function(c){return decodeURIComponent(c.replace(/^https?:\/\/[^/]+\/storage\/v1\/object\/public\/[^/]+\//,""))};function T(){var I=(0,j.useState)([]),c=D()(I,2),M=c[0],h=c[1],g=function(){var l=C()(d()().mark(function i(){var t,a,u,o,n;return d()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="uploads",e.next=3,b.storage.from(y).list(t,{limit:20,offset:0,sortBy:{column:"name",order:"desc"}});case 3:if(a=e.sent,u=a.data,o=a.error,!o){e.next=9;break}return f.FN.show({content:"\u83B7\u53D6\u56FE\u7247\u5217\u8868\u5931\u8D25",duration:2e3,icon:"fail"}),e.abrupt("return");case 9:n=(u||[]).filter(function(r){return r.name}).map(function(r){return b.storage.from(y).getPublicUrl("".concat(t,"/").concat(r.name)).data.publicUrl}),h(n.map(function(r){return{url:r}}));case 11:case"end":return e.stop()}},i)}));return function(){return l.apply(this,arguments)}}();(0,j.useEffect)(function(){g()},[]);var w=(0,j.useCallback)(function(){var l=C()(d()().mark(function i(t){var a,u,o,n,m,e,r,v;return d()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return a=t.name.split(".").pop(),u="".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2),".").concat(a),o="uploads/".concat(u),p.next=5,R(t);case 5:return n=p.sent,p.next=8,b.storage.from(y).upload(o,n,{cacheControl:"3600",upsert:!0,contentType:t.type});case 8:if(m=p.sent,e=m.error,!e){p.next=13;break}throw f.FN.show({content:"\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",duration:2e3,icon:"fail"}),e;case 13:return r=b.storage.from(y).getPublicUrl(o),v=r.data,f.FN.show({content:"\u4E0A\u4F20\u6210\u529F",duration:1500,icon:"success"}),p.abrupt("return",{url:v.publicUrl});case 16:case"end":return p.stop()}},i)}));return function(i){return l.apply(this,arguments)}}(),[]),N=function(){var l=C()(d()().mark(function i(t){var a,u,o,n,m;return d()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,f.Vq.confirm({content:"\u662F\u5426\u786E\u8BA4\u5220\u9664"});case 2:if(a=r.sent,a){r.next=5;break}return r.abrupt("return",!1);case 5:if(u=t.url,u){r.next=8;break}return r.abrupt("return",!1);case 8:return o=S(u),r.next=11,b.storage.from(y).remove([o]);case 11:if(n=r.sent,m=n.error,!m){r.next=16;break}return f.FN.show({content:"\u5220\u9664\u5931\u8D25",duration:2e3,icon:"fail"}),r.abrupt("return",!1);case 16:return f.FN.show({content:"\u5DF2\u5220\u9664",duration:1500,icon:"success"}),h(function(v){return v.filter(function(z){return z.url!==u})}),r.abrupt("return",!0);case 19:case"end":return r.stop()}},i)}));return function(t){return l.apply(this,arguments)}}();return(0,F.jsxs)("div",{className:k.editContainer,children:[(0,F.jsx)(f.l2,{onBack:function(){return P.m8.push("/")},style:{background:"#fff"},children:"\u56FE\u7247\u7F16\u8F91"}),(0,F.jsx)("div",{className:k.body,children:(0,F.jsx)(f.wA,{value:M,onChange:h,upload:w,onDelete:N,maxCount:5})})]})}}}]);
